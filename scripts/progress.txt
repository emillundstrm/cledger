# Ralph Progress Log
Started: Sun Feb  1 09:54:56 CET 2026

## Codebase Patterns
- Gradle wrapper uses Gradle 8.7 (8.14.4 has download issues with Java 17 SSL)
- Backend uses 4-space indentation for Java code (per ARCHITECTURE.md)
- Test profile uses H2 in-memory DB with Flyway disabled and ddl-auto: create-drop
- Test resources at backend/src/test/resources/application.yml override main config
- Frontend uses Node 20 via nvm (nvm use 20); npm is not on PATH without nvm
- Frontend uses Tailwind CSS v4 with @tailwindcss/vite plugin (no tailwind.config.js needed)
- ShadCN v3 with Tailwind v4 uses CSS variables in src/index.css for theming
- Import alias @/ maps to src/ via tsconfig paths and vite resolve alias
- Vitest config is in separate vitest.config.ts (not merged into vite.config.ts)
- Frontend uses 4-space indentation (matches backend convention)
- Session entity uses public no-arg constructor (not protected) so tests can instantiate directly
- @ElementCollection with @CollectionTable maps session_types and session_pain_flags tables
- @DataJpaTest is the right annotation for repository-only tests (auto-configures H2 + JPA)
- Spring Boot 3.4+ uses @MockitoBean instead of deprecated @MockBean for test mocking
- Use @WebMvcTest(ControllerClass.class) for controller tests with MockMvc
- SessionResponse.fromEntity() is the standard pattern for entity-to-DTO conversion
- React Router v7 uses `react-router` package (not react-router-dom); BrowserRouter/MemoryRouter imported from "react-router"
- ShadCN auto-generated UI components trigger react-refresh/only-export-components lint error; disabled in eslint.config.js for src/components/ui/
- Page components live in src/pages/, layout components in src/components/layout/
- Use MemoryRouter with initialEntries for testing routed components in Vitest
- @tanstack/react-query is the standard for data fetching; QueryClientProvider wraps BrowserRouter in App.tsx
- API types live in src/api/types.ts; fetch functions in src/api/sessions.ts
- For testing react-query components: create QueryClient with retry:false, wrap in QueryClientProvider + MemoryRouter
- Mock API modules with vi.mock("@/api/sessions") and vi.mocked() for typed mocks
- ResizeObserver polyfill required in test/setup.ts for Radix UI components (ToggleGroup, Popover, etc.)
- SessionForm component is reusable for create and edit — accepts initialData, onSubmit, onCancel, submitLabel props
- date-fns `format()` is used for date formatting in the form; installed as dependency of react-day-picker
- @testing-library/user-event is needed for simulating user interactions (clicks, typing) in form tests
---

## 2026-02-01 - US-001
- What was implemented: Spring Boot 3.5.0 backend project scaffold with Gradle build
- Files changed:
  - backend/ (entire project scaffold from Spring Initializr)
  - backend/build.gradle - Spring Web, Data JPA, PostgreSQL, Flyway, H2 (test)
  - backend/src/main/resources/application.yml - PostgreSQL config (localhost:5432/cledger)
  - backend/src/main/java/com/cledger/controller/HealthController.java - GET /api/health
  - backend/src/test/java/com/cledger/controller/HealthControllerTest.java - WebMvcTest for health endpoint
  - backend/src/test/resources/application.yml - H2 test config
- **Learnings for future iterations:**
  - Spring Initializr now requires Boot 3.5.0+ (3.4.x no longer available)
  - Gradle 8.14.4 download fails with Java 17 SSL issues; using 8.7 from cache works
  - @WebMvcTest is preferred for controller-only tests (no DB needed)
  - CledgerApplicationTests with @SpringBootTest uses H2 for context loading tests
---

## 2026-02-01 - US-002
- What was implemented: React frontend project with Vite, TypeScript, Tailwind CSS v4, and ShadCN UI
- Files changed:
  - frontend/ (entire Vite + React + TypeScript scaffold)
  - frontend/vite.config.ts - Tailwind v4 plugin, path alias, /api proxy to localhost:8080
  - frontend/vitest.config.ts - Vitest config with jsdom environment
  - frontend/tsconfig.json - Added @/ path alias
  - frontend/tsconfig.app.json - Added @/ path alias
  - frontend/src/index.css - Tailwind v4 import with ShadCN theme variables
  - frontend/src/App.tsx - Placeholder page with CLedger title
  - frontend/src/App.test.tsx - Basic render tests
  - frontend/src/test/setup.ts - Vitest setup with jest-dom matchers
  - frontend/src/lib/utils.ts - ShadCN utility (cn function)
  - frontend/components.json - ShadCN configuration
- **Learnings for future iterations:**
  - Tailwind v4 uses @import "tailwindcss" instead of @tailwind directives
  - ShadCN init requires import alias configured in tsconfig before running
  - Use `npx shadcn@latest init -d` for default ShadCN setup
  - Vitest v4 works with separate vitest.config.ts using vitest/config defineConfig
  - Must load nvm before any npm/npx command: `export NVM_DIR="$HOME/.nvm" && . "$NVM_DIR/nvm.sh" && nvm use 20`
---

## 2026-02-01 - US-003
- What was implemented: Database schema for training sessions with Flyway migration, JPA entity, and Spring Data repository
- Files changed:
  - backend/src/main/resources/db/migration/V1__create_sessions_tables.sql - Flyway migration for sessions, session_types, session_pain_flags tables
  - backend/src/main/java/com/cledger/entity/Session.java - JPA entity with @ElementCollection for types and pain flags
  - backend/src/main/java/com/cledger/repository/SessionRepository.java - Spring Data JPA repository
  - backend/src/test/java/com/cledger/repository/SessionRepositoryTest.java - Repository tests (save, retrieve, delete with element collections)
- **Learnings for future iterations:**
  - Session entity constructor must be public (not protected) for test instantiation
  - @DataJpaTest auto-configures H2 + JPA for repository tests without needing @SpringBootTest
  - @ElementCollection with @CollectionTable correctly maps join tables (session_types, session_pain_flags)
  - @PrePersist/@PreUpdate callbacks handle created_at/updated_at automatically
---

## 2026-02-01 - US-004
- What was implemented: REST API for session CRUD (GET all, GET by id, POST, PUT, DELETE)
- Files changed:
  - backend/build.gradle - Added spring-boot-starter-validation dependency
  - backend/src/main/java/com/cledger/dto/SessionRequest.java - Request DTO with Jakarta validation annotations
  - backend/src/main/java/com/cledger/dto/SessionResponse.java - Response DTO with fromEntity() factory method
  - backend/src/main/java/com/cledger/service/SessionService.java - Business logic with domain validation for enum values
  - backend/src/main/java/com/cledger/controller/SessionController.java - REST endpoints with exception handlers
  - backend/src/test/java/com/cledger/service/SessionServiceTest.java - Unit tests for service logic (12 tests)
  - backend/src/test/java/com/cledger/controller/SessionControllerTest.java - WebMvcTest for controller endpoints (10 tests)
- **Learnings for future iterations:**
  - Use @Valid on @RequestBody for Jakarta Bean Validation (NotNull, NotBlank, NotEmpty)
  - Domain validation (valid enum values) done in service layer, not annotations
  - @ExceptionHandler on controller handles SessionNotFoundException (404) and InvalidSessionException (400)
  - MethodArgumentNotValidException handler needed for @Valid failures to return structured 400 errors
  - @MockitoBean (Spring Boot 3.4+) replaces deprecated @MockBean
---

## 2026-02-01 - US-005
- What was implemented: Frontend app shell with top navigation bar and React Router routing
- Files changed:
  - frontend/package.json - Added react-router dependency
  - frontend/eslint.config.js - Added rule override for ShadCN UI component exports
  - frontend/src/App.tsx - Replaced placeholder with BrowserRouter and route definitions
  - frontend/src/App.test.tsx - Updated tests for routed layout (7 tests)
  - frontend/src/components/layout/AppLayout.tsx - Top nav with CLedger title, Sessions and Dashboard links, Outlet for route content
  - frontend/src/components/ui/button.tsx - ShadCN Button component (added via CLI)
  - frontend/src/pages/SessionsPage.tsx - Placeholder sessions list page
  - frontend/src/pages/NewSessionPage.tsx - Placeholder new session page
  - frontend/src/pages/EditSessionPage.tsx - Placeholder edit session page
  - frontend/src/pages/DashboardPage.tsx - Placeholder dashboard page
- **Learnings for future iterations:**
  - React Router v7 package is just `react-router` (not react-router-dom)
  - BrowserRouter, Routes, Route, Navigate, useLocation all from "react-router"
  - MemoryRouter with initialEntries is the way to test routed components
  - ShadCN CLI output triggers react-refresh lint errors; need eslint override for src/components/ui/
  - Use <Route element={<Layout />}> with <Outlet /> for nested layout routing
---

## 2026-02-01 - US-006
- What was implemented: Frontend session timeline list with week grouping, fetching from API
- Files changed:
  - frontend/package.json - Added @tanstack/react-query dependency
  - frontend/src/api/types.ts - Session TypeScript interface matching backend DTO
  - frontend/src/api/sessions.ts - fetchSessions() function for GET /api/sessions
  - frontend/src/App.tsx - Added QueryClientProvider wrapping BrowserRouter
  - frontend/src/pages/SessionsPage.tsx - Full implementation with week grouping, session cards, badges, loading/error/empty states
  - frontend/src/pages/SessionsPage.test.tsx - 9 tests covering loading, empty, error, rendering, week grouping, and navigation
  - frontend/src/components/ui/card.tsx - ShadCN Card component (added via CLI)
  - frontend/src/components/ui/badge.tsx - ShadCN Badge component (added via CLI)
- **Learnings for future iterations:**
  - @tanstack/react-query QueryClient must be created outside App component to avoid re-creation on re-renders
  - For testing react-query components, create a fresh QueryClient per test with retry:false to avoid flaky tests
  - vi.mock() must be called before vi.mocked() imports; hoisting makes this work but keep the pattern consistent
  - groupByWeek uses Map to preserve insertion order (sessions already sorted by date desc from API)
  - Append "T00:00:00" to date strings before `new Date()` to avoid timezone offset issues
---

## 2026-02-01 - US-007
- What was implemented: Frontend session logging form with all required fields, date picker, type toggles, radio selectors, optional fields, pain flag checkboxes, and API submission
- Files changed:
  - frontend/package.json - Added @radix-ui/react-radio-group, @radix-ui/react-label, @radix-ui/react-checkbox, @radix-ui/react-popover, @radix-ui/react-toggle, @radix-ui/react-toggle-group, react-day-picker, date-fns, @testing-library/user-event
  - frontend/src/api/types.ts - Added SessionRequest interface and constant arrays for session types, intensity, performance, productivity, pain flag values
  - frontend/src/api/sessions.ts - Added createSession() function for POST /api/sessions
  - frontend/src/components/SessionForm.tsx - Reusable session form component with all fields, defaults, and validation
  - frontend/src/pages/NewSessionPage.tsx - Full implementation with mutation, error handling, and navigation
  - frontend/src/components/SessionForm.test.tsx - 15 tests for form rendering, interaction, defaults, pre-filling, and submission
  - frontend/src/pages/NewSessionPage.test.tsx - 4 tests for page rendering, API calls, and error states
  - frontend/src/test/setup.ts - Added ResizeObserver polyfill for Radix UI components in jsdom
  - frontend/src/components/ui/ - Added 9 ShadCN components (toggle-group, radio-group, input, textarea, label, checkbox, popover, toggle, calendar)
- **Learnings for future iterations:**
  - Radix UI components (ToggleGroup, Popover) require ResizeObserver which jsdom doesn't have — must polyfill in test setup
  - ShadCN CLI may fail with SSL errors when installing deps; run npm install separately first, then retry shadcn add
  - SessionForm is designed as a reusable component accepting initialData for edit mode (US-008 can reuse it)
  - date-fns format() is available since react-day-picker depends on it
  - ToggleGroup with type="multiple" returns string[] via onValueChange — maps directly to session types
  - Submit button should be disabled when required fields (types) are empty for good UX
  - @testing-library/user-event must be installed separately from @testing-library/react
---
